{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load form_filters %}

{% block title %}{% trans "Choose a new password" %}{% endblock title %}

{% block css %}
<link rel="stylesheet" href="{% static 'style/css/main.css' %}">
<link rel="stylesheet" href="{% static 'style/css/navbar.css' %}">
<link rel="stylesheet" href="{% static 'style/css/btn.css' %}">
<link rel="stylesheet" href="{% static 'style/css/login.css' %}">
{% endblock css %}

{% block header %}
{% include 'navigation.html' %}
{% endblock header %}

{% block content %}
<div class="login-wrapper">
	<div class="login-card">

		{% if validlink %}
		<h2>{% trans "Choose a new password" %} ✅</h2>
		<p class="text-muted mb-4">
			{% trans "Enter your new password below." %}
		</p>

		<form method="post">
			{% csrf_token %}

			{% if messages %}
			{% for message in messages %}
			{% if message.tags == "error" %}
			<div class="alert alert-danger alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
			{% else %}
			<div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
				{{ message }}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
			{% endif %}
			{% endfor %}
			{% endif %}

			{% if form.non_field_errors %}
			<div class="alert alert-danger">{{ form.non_field_errors.0 }}</div>
			{% endif %}

			<div class="form-floating mb-3">
				{{ form.new_password1|add_class_if_error:"is-invalid" }}
				<label for="{{ form.new_password1.id_for_label }}">{% trans "New password" %}</label>
				{% if form.new_password1.errors %}
				<div class="invalid-feedback">{{ form.new_password1.errors.0 }}</div>
				{% endif %}
			</div>

			<div class="form-floating mb-3">
				{{ form.new_password2|add_class_if_error:"is-invalid" }}
				<label for="{{ form.new_password2.id_for_label }}">{% trans "Confirm new password" %}</label>
				{% if form.new_password2.errors %}
				<div class="invalid-feedback">{{ form.new_password2.errors.0 }}</div>
				{% endif %}
			</div>

			<div class="d-grid">
				<button type="submit" class="btn btn-primary btn-login">
					{% trans "Update password" %}
				</button>
			</div>
		</form>

		<div class="form-footer">
			<p>
				<a href="{% url 'users:login' %}">{% trans "Back to login" %}</a>
			</p>
		</div>
		{% else %}
		<h2>{% trans "This link is invalid or expired" %} ⚠️</h2>
		<p class="text-muted mb-4">
			{% trans "Please request a new password reset link." %}
		</p>

		<div class="d-grid">
			<a class="btn btn-primary btn-login" href="{% url 'password_reset' %}">
				{% trans "Request a new link" %}
			</a>
		</div>
		{% endif %}

	</div>
</div>
{% endblock content %}
